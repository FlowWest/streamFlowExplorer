<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flow Modeling Approaches • streamFlowExplorer</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Flow Modeling Approaches">
<meta property="og:description" content="streamFlowExplorer">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">streamFlowExplorer</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Flow Source Overview
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/calsim_template.html">CalSim Overview</a>
    </li>
    <li>
      <a href="../articles/cdec_template.html">CDEC Overview</a>
    </li>
    <li>
      <a href="../articles/usgs_template.html">USGS Overview</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Modeling Methods
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/flow_modeling_approaches.html">Flow Modeling Approaches</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Flow Modeling Approaches</h1>
            
      
      
      <div class="hidden name"><code>flow_modeling_approaches.Rmd</code></div>

    </div>

    
    
<p>Some sources to review - <a href="https://www.sciencedirect.com/science/article/abs/pii/S0022169418309648" class="external-link uri">https://www.sciencedirect.com/science/article/abs/pii/S0022169418309648</a></p>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Flow data modeling is crucial for various applications in hydrology,
water resource management, and environmental studies. In cases where
empirical data for a stream is lacking, several approaches can be
employed to generate flow estimates. In this document, we explore
various methods for modeling flow data when empirical data is
unavailable.</p>
<div class="section level3">
<h3 id="approach-1-timeserries-interpretation">Approach 1: Timeserries interpretation<a class="anchor" aria-label="anchor" href="#approach-1-timeserries-interpretation"></a>
</h3>
<p><strong>Benefit:</strong> Quick and easy, performs relatively well
for flow data that follows seasonal patterns. Good for data that is
fairly complete with some shorter gaps. <strong>Limitation:</strong> May
miss abnormal extreme flow events, may have more uncertainty than other
approaches</p>
<p>Using a timeserries interpolation function is a good approach if you
have relatively good data coverage but have a few data gaps. One
possible interpolation function is the
<code><a href="https://rdrr.io/pkg/forecastML/man/fill_gaps.html" class="external-link">forecastML::fill_gaps()</a></code>. For more information about this
function, see the <a href="https://rdrr.io/cran/forecastML/man/fill_gaps.html" class="external-link">forecastML
documenation.</a></p>
<div class="section level4">
<h4 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h4>
<p>I want to study the flow and temperature correlation on ___ system.
There is a USGS gage on my system, but it is missing data for _____
window.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load necessary libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://code.usgs.gov/water/dataRetrieval" class="external-link">dataRetrieval</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nredell/forecastML/" class="external-link">forecastML</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make API call to USGS to retrieve flow data for the specified site and time period</span></span>
<span><span class="va">gage_data</span> <span class="op">&lt;-</span> <span class="fu">dataRetrieval</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISdv.html" class="external-link">readNWISdv</a></span><span class="op">(</span><span class="fl">11384000</span>, <span class="st">"00060"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>date <span class="op">=</span> <span class="va">Date</span>, </span>
<span>         flow_cfs <span class="op">=</span> <span class="va">X_00060_00003</span><span class="op">)</span></span>
<span><span class="co"># 'gage_data' is the dataset containing USGS flow data with gaps</span></span>
<span><span class="co"># Fill gaps in flow data using forecastML::fill_gaps() function</span></span>
<span><span class="va">filled_data</span> <span class="op">&lt;-</span> <span class="fu">forecastML</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/forecastML/man/fill_gaps.html" class="external-link">fill_gaps</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">gage_data</span>,</span>
<span>                                     date_col <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                                     frequency <span class="op">=</span> <span class="st">"1 day"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot original and filled data for comparison</span></span>
<span><span class="va">gage_data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">flow_cfs</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_line</span><span class="op">(</span>color <span class="op">=</span> <span class="va">colors</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="flow_modeling_approaches_files/figure-html/unnamed-chunk-1-1.png" width="1440"></p>
</div>
</div>
<div class="section level3">
<h3 id="approach-2-linear-regression-between-stream-gage-data---filling-a-temporal-data-gap">Approach 2: Linear Regression between Stream Gage Data - Filling a
temporal data gap<a class="anchor" aria-label="anchor" href="#approach-2-linear-regression-between-stream-gage-data---filling-a-temporal-data-gap"></a>
</h3>
<p><strong>Benefit:</strong> Fairly quick and straightforward, linear
regression typically does a fairly good job <strong>Limitation:</strong>
Need at least some gage overlap across different conditions, if you do
not have good coverage across different conditions you may loose some of
the extreem flow events</p>
<p>One approach is to interpolate flow data for one stream using
available stream gage data. In order to do this you need at least some
gage data on the system you are trying to model and this data should
cover a variety of conditions (water year types). This method
establishes a linear correlation between the target site and other sites
that experience similar hydrological conditions. The approach requires
identifying comparable sites and establishing a relationship between
their flow data.</p>
<div class="section level4">
<h4 id="example-1">Example<a class="anchor" aria-label="anchor" href="#example-1"></a>
</h4>
<p>I am creating a regional model with data from 4 salmonid bearing
streams: Butte Creek, Mill Creek, Deer Creek, and Yuba River . I am
interested in flow data from 2000 - 2024 to match with my monitoring
data. Unfortunately, on Yuba River, there is only gage data after _____.
In order to keeep Yuba in my dataset. I need to fill in the gaps.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Data used to build models: Butte Creek</span></span>
<span><span class="co"># Butte Creek is used to build the regression models because the time series is complete and the data are high quality.</span></span>
<span><span class="va">butte</span> <span class="op">&lt;-</span> <span class="fu">cdec_query</span><span class="op">(</span>station <span class="op">=</span> <span class="st">"BCK"</span>, dur_code <span class="op">=</span> <span class="st">"H"</span>, sensor_num <span class="op">=</span> <span class="st">"25"</span>, start_date <span class="op">=</span> <span class="st">"2000-01-01"</span><span class="op">)</span></span>
<span><span class="va">butte_format</span> <span class="op">&lt;-</span> <span class="va">butte</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu">as_date</span><span class="op">(</span><span class="va">datetime</span><span class="op">)</span>,</span>
<span>           temp_degC <span class="op">=</span> <span class="fu">SRJPEdata</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SRJPEdata/man/fahrenheit_to_celsius.html" class="external-link">fahrenheit_to_celsius</a></span><span class="op">(</span><span class="va">parameter_value</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">temp_degC</span> <span class="op">&lt;</span> <span class="fl">40</span>, <span class="va">temp_degC</span> <span class="op">&gt;</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">temp_degC</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>              max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">temp_degC</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>              min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">temp_degC</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">pivot_longer</span><span class="op">(</span><span class="va">mean</span><span class="op">:</span><span class="va">min</span>, names_to <span class="op">=</span> <span class="st">"statistic"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>stream <span class="op">=</span> <span class="st">"butte creek"</span>,</span>
<span>           gage_agency <span class="op">=</span> <span class="st">"CDEC"</span>,</span>
<span>           gage_number <span class="op">=</span> <span class="st">"BCK"</span>,</span>
<span>           parameter <span class="op">=</span> <span class="st">"temperature"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">butte_format_wide</span> <span class="op">&lt;-</span> <span class="va">butte_format</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">gage_agency</span>, <span class="op">-</span><span class="va">gage_number</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">stream</span>, <span class="va">date</span><span class="op">)</span>, names_from <span class="op">=</span> <span class="st">"statistic"</span>, values_from <span class="op">=</span> <span class="st">"value"</span>, values_fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Gage Data</span></span>
<span><span class="va">YR7_daily_temps</span> <span class="op">&lt;-</span> <span class="fu">cdec_query</span><span class="op">(</span>station <span class="op">=</span> <span class="st">"YR7"</span>, dur_code <span class="op">=</span> <span class="st">"E"</span>, sensor_num <span class="op">=</span> <span class="st">"146"</span>, start_date <span class="op">=</span> <span class="st">"2019-01-01"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">yuba_format</span> <span class="op">&lt;-</span> <span class="va">YR7_daily_temps</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu">as_date</span><span class="op">(</span><span class="va">datetime</span><span class="op">)</span>,</span>
<span>           year <span class="op">=</span> <span class="fu">year</span><span class="op">(</span><span class="va">datetime</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">parameter_value</span> <span class="op">&lt;</span> <span class="fl">40</span>, <span class="va">parameter_value</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">parameter_value</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>             max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">parameter_value</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>             min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">parameter_value</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span><span class="va">mean</span><span class="op">:</span><span class="va">min</span>, names_to <span class="op">=</span> <span class="st">"statistic"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>stream <span class="op">=</span> <span class="st">"yuba river"</span>,</span>
<span>         gage_agency <span class="op">=</span> <span class="st">"CDEC"</span>,</span>
<span>         gage_number <span class="op">=</span> <span class="st">"YR7"</span>,</span>
<span>         parameter <span class="op">=</span> <span class="st">"temperature"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 4,953</span></span>
<span><span class="co">## Columns: 7</span></span>
<span><span class="co">## $ date        <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2019-09-03, 2019-09-03, 2019-09-03, 2019-09-04, 2019-09-0…</span></span>
<span><span class="co">## $ statistic   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "mean", "max", "min", "mean", "max", "min", "mean", "max",…</span></span>
<span><span class="co">## $ value       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 18.72500, 19.00000, 18.40000, 17.33958, 19.20000, 15.40000…</span></span>
<span><span class="co">## $ stream      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "yuba river", "yuba river", "yuba river", "yuba river", "y…</span></span>
<span><span class="co">## $ gage_agency <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "CDEC", "CDEC", "CDEC", "CDEC", "CDEC", "CDEC", "CDEC", "C…</span></span>
<span><span class="co">## $ gage_number <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "YR7", "YR7", "YR7", "YR7", "YR7", "YR7", "YR7", "YR7", "Y…</span></span>
<span><span class="co">## $ parameter   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "temperature", "temperature", "temperature", "temperature"…</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># combine butte and yuba together for regression modeling</span></span>
<span><span class="va">yuba_format_wide</span> <span class="op">&lt;-</span> <span class="va">yuba_format</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">gage_agency</span>, <span class="op">-</span><span class="va">gage_number</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">stream</span>, <span class="va">date</span><span class="op">)</span>, names_from <span class="op">=</span> <span class="st">"statistic"</span>, values_from <span class="op">=</span> <span class="st">"value"</span>, values_fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span></span>
<span><span class="va">yuba_regression_data_full</span> <span class="op">&lt;-</span> <span class="va">yuba_format_wide</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">mean</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>yuba_temp_mean <span class="op">=</span> <span class="va">mean</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span><span class="va">butte_format_wide</span> <span class="op">|&gt;</span> </span>
<span>              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">mean</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>butte_temp_mean <span class="op">=</span> <span class="va">mean</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Joining with `by = join_by(date)`</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># FOR PREDICTIONS identify gaps to predict data</span></span>
<span><span class="va">yuba_gap_mean</span> <span class="op">&lt;-</span> <span class="va">yuba_regression_data_full</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">yuba_temp_mean</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">butte_temp_mean</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>butte_temp <span class="op">=</span> <span class="va">butte_temp_mean</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># FOR MODEL use data where there are no missing data for either butte or feather for regression modeling</span></span>
<span><span class="va">yuba_regression_data_mean</span> <span class="op">&lt;-</span> <span class="va">yuba_regression_data_full</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">yuba_temp_mean</span><span class="op">)</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">butte_temp_mean</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>butte_temp <span class="op">=</span> <span class="va">butte_temp_mean</span>,</span>
<span>         temp <span class="op">=</span> <span class="va">yuba_temp_mean</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#### Building Mean Regression</span></span>
<span><span class="co"># MEAN Regression</span></span>
<span><span class="va">split</span> <span class="op">&lt;-</span><span class="fu">rsample</span><span class="fu">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">initial_split</a></span><span class="op">(</span><span class="va">yuba_regression_data_mean</span>, prop <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="va">train</span> <span class="op">&lt;-</span> <span class="fu">rsample</span><span class="fu">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">training</a></span><span class="op">(</span><span class="va">split</span><span class="op">)</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu">rsample</span><span class="fu">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">testing</a></span><span class="op">(</span><span class="va">split</span><span class="op">)</span></span>
<span><span class="va">yuba_mod_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">temp</span> <span class="op">~</span> <span class="va">date</span> <span class="op">+</span> <span class="va">butte_temp</span>, data <span class="op">=</span> <span class="va">train</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">yuba_mod_mean</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = temp ~ date + butte_temp, data = train)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">## -3.9293 -0.9951  0.0165  1.0214  3.1526 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##               Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)  2.118e+01  1.548e+00  13.682   &lt;2e-16 ***</span></span>
<span><span class="co">## date        -7.887e-04  8.127e-05  -9.705   &lt;2e-16 ***</span></span>
<span><span class="co">## butte_temp   5.928e-01  6.705e-03  88.407   &lt;2e-16 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 1.401 on 1315 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.8591, Adjusted R-squared:  0.8589 </span></span>
<span><span class="co">## F-statistic:  4009 on 2 and 1315 DF,  p-value: &lt; 2.2e-16</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_predict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">yuba_mod_mean</span>, <span class="va">test</span><span class="op">)</span></span>
<span><span class="va">test_predict_df</span> <span class="op">&lt;-</span> <span class="va">test</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>predicted <span class="op">=</span> <span class="va">test_predict</span><span class="op">)</span></span>
<span><span class="co"># evaluate predictions - MAPE of 10% is not bad</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="op">(</span></span>
<span>  <span class="va">test_predict_df</span><span class="op">$</span><span class="va">predicted</span> <span class="op">-</span> <span class="va">test_predict_df</span><span class="op">$</span><span class="va">temp</span></span>
<span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="va">test_predict_df</span><span class="op">$</span><span class="va">temp</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.08614569</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Predictions</span></span>
<span><span class="va">yuba_gap_predicted_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">yuba_mod_mean</span>, <span class="va">yuba_gap_mean</span><span class="op">)</span></span>
<span><span class="va">yuba_mean_predicted</span> <span class="op">&lt;-</span> <span class="va">yuba_gap_mean</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">yuba_gap_predicted_mean</span>,</span>
<span>         statistic <span class="op">=</span> <span class="st">"mean_predicted"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">value</span>, <span class="va">statistic</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">yuba_mean_predicted</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="flow_modeling_approaches_files/figure-html/unnamed-chunk-2-1.png" width="1440"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># TODO kinda a weird trend line, update</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="approach-3-representative-stream-and-scaling">Approach 3: Representative Stream and Scaling<a class="anchor" aria-label="anchor" href="#approach-3-representative-stream-and-scaling"></a>
</h3>
<p><strong>Benefit:</strong> <strong>Limitation:</strong></p>
<p>Using a representative stream with available flow data can also be an
effective approach. By selecting a stream with similar characteristics
(e.g., drainage area, land use, climate), we can scale its flow data to
estimate flows for the target stream.</p>
<div class="section level4">
<h4 id="example-2">Example<a class="anchor" aria-label="anchor" href="#example-2"></a>
</h4>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example R code for scaling</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="approach-4-utilizing-existing-modeled-flow-data">Approach 4: Utilizing Existing Modeled Flow Data<a class="anchor" aria-label="anchor" href="#approach-4-utilizing-existing-modeled-flow-data"></a>
</h3>
<p><strong>Benefit:</strong> CalSim or SACWAM already modeled it for
you, no need to repeat the process <strong>Limitation:</strong> Montly
flow granualarity may be limiting for your use case</p>
<p>Existing modeled flow data from sources like Calsim or SACWAM can be
utilized. Typically these modeled sources have already used an approach
to fill data gaps. These models simulate hydrological processes and
provide flow outputs, which can be directly used across the system.
However, these modeled datasets are only available at a monthly
timestep, additional modeling may be needed to produce finer scale flow
data.</p>
</div>
<div class="section level3">
<h3 id="approach-5-expanding-existing-modeled-flow-data">Approach 5: Expanding Existing Modeled Flow Data<a class="anchor" aria-label="anchor" href="#approach-5-expanding-existing-modeled-flow-data"></a>
</h3>
<p><strong>Benefit:</strong> <strong>Limitation:</strong></p>
<p>If existing modeled flow data is available but lacks the required
resolution, we can expand it to provide daily flow values.</p>
<p>HOW?</p>
<div class="section level4">
<h4 id="example-3">Example<a class="anchor" aria-label="anchor" href="#example-3"></a>
</h4>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Erin Cain.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
