<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Natural Flows Overview Document • streamFlowExplorer</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Natural Flows Overview Document">
<meta property="og:description" content="streamFlowExplorer">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">streamFlowExplorer</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Flow Source Overview
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/calsim_template.html">CalSim Overview</a>
    </li>
    <li>
      <a href="../articles/cdec_template.html">CDEC Overview</a>
    </li>
    <li>
      <a href="../articles/usgs_template.html">USGS Overview</a>
    </li>
    <li>
      <a href="../articles/natural_flows_template.html">Natural Flows Overview</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Modeling Methods
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/flow_modeling_approaches.html">Flow Modeling Approaches</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Natural Flows Overview Document</h1>
            
      
      
      <div class="hidden name"><code>natural_flows_template.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="natural-flows-summary">Natural Flows Summary<a class="anchor" aria-label="anchor" href="#natural-flows-summary"></a>
</h2>
<p>Natural Flows uses a machine learning model to estimate monthly
unimpaired flows for all stream segments in California, as well as
functional flow metrics including baseflow, pulse flow, and recession
flow magnitudes, durations, and timing.</p>
<ul>
<li>
<strong>Source:</strong> The Nature Conservancy &amp; Code for
Nature, based on UC Davis <a href="https://ceff.ucdavis.edu" class="external-link">California
Environmental Flows Framework</a> research and USGS modeling
frameworks.</li>
<li>
<strong>Accessibility:</strong> Outputs are public, open and
accessible online at <a href="https://rivers.codefornature.org" class="external-link">rivers.codefornature.org</a>.
The machine learning model for estimating monthly unimpaired flows is
not publicly accessible. However, the model used to calculate functional
flow metrics is published as <a href="https://github.com/leogoesger/func-flow" class="external-link">func-flow</a> under the
UC Davis <a href="https://github.com/hrvg/ucd-eflow" class="external-link">Environmental Flows
Project</a>.</li>
<li>
<strong>Temporal Coverage:</strong> The temporal range of model
results is 1950 - 2023.</li>
<li>
<strong>Spatial Coverage:</strong> Model results are available for
all NHDPlusV2 flowlines (<code>comid</code>s) in the Central Valley and
the rest of California. The reliability of results varies based on the
spatial and temporal distribution of USGS streamgages which were used to
train the model.<br>
</li>
<li>
<strong>Maintenance:</strong> Maintained by the Natural Flows
research team with regular updates.</li>
<li>
<strong>Contact:</strong> Julie Zimmerman (Nature Conservancy);
Daren Carlisle (USGS); Ted Grantham (UC Berkeley)</li>
<li>
<strong>Utilized By:</strong> TBC</li>
</ul>
<p>Detailed in the <a href="https://ceff.ucdavis.edu/tech-report" class="external-link">technical report</a></p>
</div>
<div class="section level2">
<h2 id="natural-flows-model-summary">Natural Flows Model Summary<a class="anchor" aria-label="anchor" href="#natural-flows-model-summary"></a>
</h2>
<p>There are two types of model output.</p>
<ul>
<li>
<strong>Monthly Dataset (California Unimpaired Flows
Database)</strong><a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>: The core output of the Natural Flows
project. A random forest model was used to predict unimpaired flows at a
monthly timestep for all stream segments in California. Based on peer
reviewed research from Zimmerman et al.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>.</li>
</ul>
<ul>
<li>
<strong>Functional Flow Metrics</strong> <a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>: Estimation of the
functional flows metrics, as defined by the <a href="https://ceff.ucdavis.edu/" class="external-link">California Environmental Flows
Framework</a>, for modeled unimpaired flows. Based on peer reviewed
research from Grantham et al.<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>
</li>
</ul>
<div class="section level3">
<h3 id="monthly-dataset-california-unimpaired-flows-database">Monthly Dataset (California Unimpaired Flows Database)<a class="anchor" aria-label="anchor" href="#monthly-dataset-california-unimpaired-flows-database"></a>
</h3>
<p>The monthly dataset provides unimpaired flow estimates at a monthly
timestep for all stream segments in California.</p>
<p><strong>Note regarding alternatives:</strong> The Department of Water
Resources (DWR) released its own model of unimpaired flows for the
Central Valley. This product is described in the technical report,
<em><a href="https://data.ca.gov/dataset/estimates-of-natural-and-unimpaired-flows-for-the-central-valley-of-california-wy-1922-2014" class="external-link">Estimates
of Natural and Unimpaired Flows for the Central Valley of California: WY
1922-2014</a></em>. Unimpaired flows data can be retrieved via the CDEC
system via sensor code <code>8</code> (FNF, FULL NATURAL FLOW, CFS).
Refer to CDEC documentation for details.</p>
</div>
<div class="section level3">
<h3 id="functional-flow-metrics">Functional Flow Metrics<a class="anchor" aria-label="anchor" href="#functional-flow-metrics"></a>
</h3>
<p>The model divides the water year into the dry season (low base
flows), wet season (higher base flows beginning with a fall pulse flow
and punctuated by various peak flows), and spring recession period (the
transition back from high to low flows). As described by The Nature
Conservancy:</p>
<blockquote>
<p>Using a similar modeling approach [to the monthly dataset],
functional flow metrics were predicted for every stream segment in the
state (Grantham et al. 2022). One key difference between the approaches
is that monthly flows were predicted for each month over the time period
of 1950-2015, whereas the functional flow metric models generate
long-term predictions (across the entire time period of 1950-2015) of
functional flows metric values for each stream segment. The expected
natural range of functional flows are reported for all years, and for
subsets of years classified as “wet”, “moderate” and “dry” water
years.</p>
</blockquote>
<p>Five categories of functional flow metrics are reported, based on the
five flow components described by Yarnell et al, 2015<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a> and implemented in the
<a href="https://eflows.ucdavis.edu/hydrology" class="external-link">eFlows Functional Flow
Calculator</a><a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a>. As described in the Natural Flows
application:</p>
<ul>
<li><p><strong>dry-season base flow.</strong> Dry-season base flows
support native species during the dry-season period when water quality
and quantity limit habitat suitability.</p></li>
<li><p><strong>fall pulse flow.</strong> The first major storm event
following the dry season. These flows represent the transition from dry
to wet season and serve important functions, such as moving nutrients
downstream, improving water stream flow water quality, and signaling
species to migrate or spawn.</p></li>
<li><p><strong>wet-season base flow.</strong> Wet-season base flows
support native species that migrate through and over-winter in
streams.</p></li>
<li><p><strong>peak flow.</strong> Peak flow events transport a
significant portion of sediment load, inundate floodplains, and maintain
and restructure river corridors.</p></li>
<li><p><strong>spring recession flow.</strong> Spring recession flows
represent the transition from high to low flows, provide reproductive
and migratory cues, and redistribute sediment.</p></li>
</ul>
<p><img src="https://www.frontiersin.org/files/Articles/787473/fenvs-10-787473-HTML/image_m/fenvs-10-787473-g001.jpg"></p>
</div>
<div class="section level3">
<h3 id="architecture">Architecture<a class="anchor" aria-label="anchor" href="#architecture"></a>
</h3>
<p>The predictive model architecture is summarized by <a href="https://rivers.codefornature.org/#/science" class="external-link">The Nature
Conservancy</a> as follows:</p>
<blockquote>
<p><strong>Predicted Monthly Flows:</strong> We partnered with the U.S.
Geological Survey (USGS) to develop a modeling approach that uses
machine learning to predict monthly flows statewide. We identified 250
reference stream gages with little or no flow alteration across the
state and split them into three regions based on climate and hydrologic
conditions: Interior Mountains (including the Sierra Nevada and Klamath
mountains), North Coastal Mountains (including the mountains in the
north western portion of the state), and Xeric (including the Central
Valley, Central and South Coast, and desert portions of the state).
Using the observed monthly flows at the reference gages, we developed
statistical models for each region that accurately predicted streamflow
at these reference gages using fixed physical watershed characteristics
(such as geology, soils, and elevation) and monthly climate data (such
as precipitation, air temperature, and runoff volume). The models for
each region were then used to predict flows at all streams in that
region, using the NHDPlus Version 2 (Horizon Systems, 2018) to delineate
stream reaches based on a common identifier (COMID). For each stream
reach, we report the expected monthly mean, median, maximum, and minimum
natural flow values for all months from 1950 to 2015. For each of these
metrics, we also provide the average flow value predicted by the model
(“estimated”) and the range of uncertainty, expressed as the 10th and
90th percentile of predicted values (“P10” and “P90”). For a full
description of the datasets and methods used to generate the natural
flow data, see Zimmerman et al, 2017.</p>
</blockquote>
<blockquote>
<p><strong>Predicted Functional Flows:</strong> Using a similar modeling
approach, functional flow metrics were predicted for every stream
segment in the state (Grantham et al. 2022). One key difference between
the approaches is that monthly flows were predicted for each month over
the time period of 1950-2015, whereas the functional flow metric models
generate long-term predictions (across the entire time period of
1950-2015) of functional flows metric values for each stream segment.
The expected natural range of functional flows are reported for all
years, and for subsets of years classified as “wet”, “moderate” and
“dry” water years. For this exercise, a set of 219 reference gages was
used to train the models. We modeled metrics associated with five
functional flow components including the fall pulse flow, wet-season
baseflow, peak flow, spring recession flow, and dry-season base flow
(Yarnell et al. 2020). Functional flow metrics that describe each of
these functional flow components are described in the tables below. For
each FFM, predictions are provided as a range (10th, 50th, and 90th
percentile values), which reflects both model uncertainty and
interannual variation. In <a href="https://ceff.ucdavis.edu/sectionA" class="external-link">Section A</a> of CEFF, these
predicted metrics are used to identify ecological flow criteria to
protect native aquatic species and communities. For a full description
of the datasets and methods used to predict functional flow metrics, see
Appendix D of the <a href="https://ceff.ucdavis.edu/guidance-document" class="external-link">CEFF Guidance
Document</a> and Grantham et al, 2022.</p>
</blockquote>
</div>
<div class="section level3">
<h3 id="accessibility">Accessibility<a class="anchor" aria-label="anchor" href="#accessibility"></a>
</h3>
<p>The methods and assumptions used in the predictive models are well
documented in the associated peer-reviewed papers.</p>
<p>For the Monthly Flows prediction, the <a href="https://doi.org/10.1111/fwb.13058" class="external-link">Zimmerman et al. (2017)</a>
paper contains the following <a href="https://onlinelibrary.wiley.com/doi/10.1111/fwb.13058" class="external-link">supporting
information</a>:</p>
<ul>
<li>Table S1. Description of physical basin attributes considered as
potential predictors in statistical models of baseline monthly flows in
California streams.</li>
<li>Table S2. Performance statistics of models predicting natural
maximum, mean, and minimum monthly flows in California regions.</li>
<li>Data S1. Predictor variable importance measures from random forest
models described in Zimmerman et al. 2017.<br>
</li>
<li>Text S1. Online Data Repository and Visualization</li>
</ul>
<p>Similarly, for the Functional Flows prediction, the <a href="https://doi.org/10.3389/fenvs.2022.787473" class="external-link">Grantham et
al. (2022)</a> paper contains <a href="https://figshare.com/collections/Modeling_Functional_Flows_in_California_s_Rivers/5888936" class="external-link">supplemental
online materials</a> including:</p>
<ul>
<li>Table S1. Reference gages for functional flow metric modeling</li>
<li>Table S2. Predictor variables for functional flow metric
models<br>
</li>
<li>Table S3. Variable importance rankings for functional flow metric
models</li>
<li>Table S4. Functional flow metric model performance statistics</li>
<li>Table S5. Functional flow metric model performance statistics by
stream class</li>
</ul>
</div>
<div class="section level3">
<h3 id="update-procedure">Update procedure<a class="anchor" aria-label="anchor" href="#update-procedure"></a>
</h3>
<p>Predicted monthly flows have been updated several times, as described
in the <a href="https://rivers.codefornature.org/#/science" class="external-link">Methods</a>
section. For example, on June 2022 an updated set of PRISM monthly
climate data was incorporated, the stream network accumulation method
was updated, and other computational methods were revised.</p>
</div>
<div class="section level3">
<h3 id="qaqc-procedures">QA/QC procedures<a class="anchor" aria-label="anchor" href="#qaqc-procedures"></a>
</h3>
<p>Initial model QA/QC is documented in the associated peer-reviewed
papers. Ongoing QA/QC procedures are not defined.</p>
</div>
<div class="section level3">
<h3 id="data-inputs">Data Inputs<a class="anchor" aria-label="anchor" href="#data-inputs"></a>
</h3>
<p>Querying the dataset requires stream segments from the <a href="https://nhdplus.com/NHDPlus/NHDPlusV2_home.php" class="external-link">NHDPlusV2
dataset</a> distributed by <a href="https://www.epa.gov/waterdata/get-nhdplus-national-hydrography-dataset-plus-data" class="external-link">US
EPA</a>. Stream segments are identified by unique <code>COMID</code>
identification numbers. For analyses that are using a hydrography
dataset other than NHDPlusV2 (for example, <a href="https://nhdplus.com/NHDPlus/NHDPlusV1_home.php" class="external-link">NHDPlus v1</a>, <a href="https://www.usgs.gov/national-hydrography/nhdplus-high-resolution" class="external-link">NHDPlus
HR</a>, <a href="https://www.calfish.org/programsdata/referencelayershydrography/californiahydrography.aspx" class="external-link">CalHydro100K</a>,
or <a href="https://data.cnra.ca.gov/dataset/california-streams" class="external-link">California
Streams</a>), use of spatial joins or crosswalk tables will be necessary
to retrieve the desired <code>COMID</code> identifiers.</p>
</div>
<div class="section level3">
<h3 id="model-outputs">Model Outputs<a class="anchor" aria-label="anchor" href="#model-outputs"></a>
</h3>
<p>Model output data can be accessed in at least two ways:</p>
<ul>
<li>
<p>API documented at <a href="https://rivers.codefornature.org/#/data" class="external-link">https://rivers.codefornature.org/#/data</a></p>
<ul>
<li><p>Monthly data: Query CSV via GET request at
<code>https://flow-api.codefornature.org/v2/stream/?comids=...&amp;...</code>
for a list of COMIDs or all COMIDs. Filter parameters for years, months,
statistics, and variables are defined in the API documentation. POST
requests are also possible via RESTful API.</p></li>
<li><p>Functional Flow Metrics: Query CSV via GET request
<code>https://flow-api.codefornature.org/v2/ffm/?comids=...&amp;...</code>
for a list of COMIDs or all COMIDs. Filter parameters for metrics, water
year types, modeling values, and gage data are defined in the API
documentation. POST requests are also possible via RESTful API.</p></li>
</ul>
</li>
<li>
<p>Direct download</p>
<ul>
<li>Monthly data: Not available for direct download</li>
<li>Functional flow metrics: full ZIP download explored below</li>
</ul>
</li>
</ul>
<div class="section level4">
<h4 id="monthly-dataset">Monthly Dataset<a class="anchor" aria-label="anchor" href="#monthly-dataset"></a>
</h4>
<p>Queries output a longform CSV of the following form.</p>
<ul>
<li>
<code>comid</code> (string): NHDPlusV2 common identifier</li>
<li>
<code>statistic</code> (string): statistics, e.g. max, mean, median,
min</li>
<li>
<code>variable</code> (string): percentile of model runs</li>
<li>
<code>year</code> (integer): model year</li>
<li>
<code>month</code> (integer): model month</li>
<li>
<code>value</code> (number): modelled value</li>
</ul>
</div>
<div class="section level4">
<h4 id="functional-flow-metrics-ffm-dataset">Functional Flow Metrics (FFM) Dataset<a class="anchor" aria-label="anchor" href="#functional-flow-metrics-ffm-dataset"></a>
</h4>
<p>The data table is long form, with one row per flowline
(<code>comid</code>), per water year type (<code>wyt</code>), per
functional flow metric (<code>ffm</code>). The raw table takes the
following form, with descriptive text sourced from the Natural Flows
website.</p>
<ul>
<li>
<code>comid</code> (string): NHDPlusV2 common identifier</li>
<li>
<code>ffm</code> (string): functional flows metrics code (see
…)</li>
<li>
<code>wyt</code> (string): water year type</li>
<li>
<code>p10</code>, <code>p25</code>, <code>p50</code>,
<code>p75</code>, <code>p90</code>: modeling values for 10, 25, 50, 75
and 90 percentile of runs, use p50 for the most likely value</li>
<li>
<code>unit</code>: measurement unit for p10, p25, p50, p75, and
p90</li>
<li>
<code>source</code>: source of p10, p25, p50, p75, and p90</li>
</ul>
<p>For reaches with streamgages, an additional set of rows and
functional flow metrics are included, reporting the metrics derived from
the observed gage data rather than the model result. For these rows
(<code>source=="observed"</code>), the following fields are also
populated.</p>
<ul>
<li>
<code>gage_id</code>: USGS gage id where observed</li>
<li>
<code>observed_years</code>: number of years of observations</li>
<li>
<code>observed_year_start</code>: first water year of
observations</li>
<li>
<code>observed_year_end</code>: last water year of observations</li>
<li>
<code>alteration</code>: alteration compared to modelled value</li>
</ul>
<p>The following attributes are included in the table, with values
reported as separate variables for the percentiles <code>p10</code>,
<code>p25</code>, <code>p50</code>, <code>p75</code>, <code>p90</code>.
Some attributes are recorded for the overall water year type
<code>all</code> while others are reported for each of <code>dry</code>,
<code>moderate</code>, <code>wet</code>.</p>
<p>Metrics are broken down into the following flow components, each
reporting some sort of magnitude, timing, and duration information.</p>
<ul>
<li>
<strong><code>ds</code> = dry-season base flow.</strong> Reported
separately for <code>dry</code>, <code>moderate</code>, <code>wet</code>
water year types.
<ul>
<li>
<code>ds_mag_50</code> = <strong>dry-season baseflow</strong> =
Calculated as 50th percentile of daily flow within dry season (cfs)</li>
<li>
<code>ds_mag_90</code> = <strong>dry-season high baseflow</strong> =
Calculated as 90th percentile of daily flow within dry season (cfs)</li>
<li>
<code>ds_tim</code> = <strong>dry-season start</strong> = Start date
of dry season (water year day)</li>
<li>
<code>ds_dur</code> = <strong>dry-season duration</strong> = Number
of days from start of dry season to start of wet season (days)</li>
</ul>
</li>
<li>
<strong><code>fa</code> = fall pulse flow.</strong> Reported
separately for <code>dry</code>, <code>moderate</code>, <code>wet</code>
water year types.
<ul>
<li>
<code>fa_mag</code> = Peak magnitude of fall pulse event (maximum
daily peak flow during event) (cfs)</li>
<li>
<code>fa_tim</code> = Date of fall pulse event peak (water year
day)</li>
<li>
<code>fa_dur</code> = Duration of fall pulse event (days)</li>
</ul>
</li>
<li>
<strong><code>wet</code> = wet-season base flow.</strong> Reported
separately for <code>dry</code>, <code>moderate</code>, <code>wet</code>
water year types.
<ul>
<li>
<code>wet_bfl_mag_10</code> = Wet-season base flow, calculated as
10th percentile of daily flows within the wet season (cfs)</li>
<li>
<code>wet_bfl_mag_50</code> = Wet-season median flow, calculated as
50th percentile of daily flows within the wet season (cfs)</li>
<li>
<code>wet_tim</code> = Start date of wet season (water year
day)</li>
<li>
<code>wet_bfl_dur</code> = Number of days from start of wet season
to start of spring recession period (days)</li>
</ul>
</li>
<li>
<strong><code>peak</code> = peak flow.</strong> Reported separately
for <code>2</code>-year, <code>5</code>-year, and <code>10</code>-year
recurrence intervals (<code>#</code>).
<ul>
<li>
<code>peak_#</code> = Peak flow magnitude for the specified
recurrence interval (cfs)</li>
<li>
<code>peak_dur_#</code> = Cumulative number of days in which this
peak flow magnitude is exceeded within a season (days)</li>
<li>
<code>peak_freq_#</code> = Number of times that this peak flow
magnitude is exceeded within a season (number of occurrences)</li>
</ul>
</li>
<li>
<strong><code>sp</code> = spring recession flow.</strong> Reported
separately for <code>dry</code>, <code>moderate</code>, <code>wet</code>
water year types.
<ul>
<li>
<code>sp_tim</code> = Start date of spring season, defined as 4 days
after last wet-season peak (water year day)</li>
<li>
<code>sp_mag</code> = Daily flow on start date of spring recession
period. (cfs)</li>
<li>
<code>sp_dur</code> = Number of days from start of spring recession
period to start of dry season (days)</li>
<li>
<code>sp_roc</code> = Recession rate, defined as median daily rate
of change (%) over decreasing periods during the spring recession
period</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="section level2">
<h2 id="spatial-temporal-coverage">Spatial &amp; Temporal Coverage<a class="anchor" aria-label="anchor" href="#spatial-temporal-coverage"></a>
</h2>
<p>Plot and Chart that show coverage over watersheds, map here to show
temporal coverage for a site # years or something Highlighting major
limitations, full time periods missing across many watersheds</p>
<p>Spatial coverage of flowlines with model data (showing 10-year peak
flow p50 value as an example)</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_zm</span><span class="op">(</span><span class="va">flowlines_sf</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">naturalflows_tb</span>, <span class="va">ffm</span><span class="op">==</span><span class="st">"peak_10"</span> <span class="op">&amp;</span> <span class="va">source</span><span class="op">==</span><span class="st">"model"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">p50</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_sf</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color<span class="op">=</span><span class="va">p50</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_color_viridis_c</span><span class="op">(</span>trans<span class="op">=</span><span class="st">"log"</span>, direction<span class="op">=</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="natural_flows_template_files/figure-html/plot-peak10-1.png" width="1440"></p>
<p>Spatial coverage of observed (training) data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">st_zm</span><span class="op">(</span><span class="va">flowlines_sf</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">naturalflows_tb</span>, <span class="va">ffm</span><span class="op">==</span><span class="st">"peak_10"</span> <span class="op">&amp;</span> <span class="va">source</span><span class="op">==</span><span class="st">"observed"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_sf</span><span class="op">(</span>data<span class="op">=</span><span class="fu">st_zm</span><span class="op">(</span><span class="va">flowlines_sf</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"gray"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_sf</span><span class="op">(</span>color<span class="op">=</span><span class="st">"darkred"</span><span class="op">)</span></span></code></pre></div>
<p><img src="natural_flows_template_files/figure-html/plot-observed-1.png" width="1440"></p>
<p>Of the 86148 NHDPlusV2 segments in the Central Valley, 60716 have
natural flows estimates, a total of 70%. Generally, the missing segments
are secondary channels or very minor tributaries, along with canals and
aqueducts and other non-stream flowlines.</p>
</div>
<div class="section level2">
<h2 id="data-use-and-limitations">Data use and limitations<a class="anchor" aria-label="anchor" href="#data-use-and-limitations"></a>
</h2>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th>Use Case</th>
<th>Benefits</th>
<th>Limitations</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>
<strong>Planning environmentally optimal dam release requirements /
schedules</strong> based on natural hydrographs</td>
<td>Quickly accessible for any stream reach regardless of historical
unimpaired flow data</td>
<td>May need refinement before applying for site-scale
decision-making</td>
</tr>
<tr class="even">
<td>
<strong>Filling in gage data gaps</strong>: input to H&amp;H models
on ungaged streams</td>
<td>Well-suited for filling gage data gaps on unimpaired streams</td>
<td>Not usable for this purpose for impaired/dammed streams</td>
</tr>
<tr class="odd">
<td>
<strong>Watershed-scale habitat modeling</strong>: characterizing
streams and building typology</td>
<td>Functional flow metrics allow rapid understanding of stream
hydrology at extensive spatial scale</td>
<td></td>
</tr>
<tr class="even">
<td>
<strong>Geomorphic studies and flood modeling</strong>: Alternative
source of peak flows (Q2,Q5,Q10)</td>
<td>Quickly accessible for any stream reach regardless of gage present;
provides margins of error; likely a more reliable estimate than
traditional regional regression</td>
<td>Represents unimpaired flow (although so does regional regression) so
not applicable on impaired/dammed streams; does not include estimates
above Q10; for gaged streams not as reliable as Bulletin 17C</td>
</tr>
<tr class="odd">
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>Zimmerman, J. K. H., Carlisle, D. M., May, J.T.,
Klausmeyer, K. R., Grantham, T. E., Brown, L. R. &amp; Howard, J. K.
(2023). <em>California Unimpaired Flows Database v2.1.2</em>, The Nature
Conservancy. San Francisco CA. <a href="https://rivers.codefornature.org/" class="external-link">https://rivers.codefornature.org/</a><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Zimmerman, J. K. H., Carlisle, D. M., May, J.T.,
Klausmeyer, K. R., Grantham, T. E., Brown, L. R. &amp; Howard, J. K.
(2017). Patterns and magnitude of flow alteration in California, USA.
<em>Freshwater Biology</em> 63: 859-873. <a href="https://doi.org/10.1111/fwb.13058" class="external-link">https://doi.org/10.1111/fwb.13058</a><a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>California Environmental Flows Working Group (CEFWG).
California Natural Flows Database: <em>Functional flow metrics
v1.2.1</em>, May 2021. <a href="https://rivers.codefornature.org/" class="external-link">https://rivers.codefornature.org/</a><a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>Grantham, T. E., Carlisle, D. M., Howard, J., Lane, B.,
Lusardi, R., Obester, A., Sandoval-Solis, S., Stanford, B., Stein, E.
D., Taniguchi-Quan, K. T., Yarnell, S. M. &amp; Zimmerman, J. K. H.
(2022) Modeling Functional Flows in California’s Rivers. <em>Frontiers
in Environmental Science</em> 10:787473. <a href="https://doi.org/10.3389/fenvs.2022.787473" class="external-link">https://doi.org/10.3389/fenvs.2022.787473</a><a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>Sarah M. Yarnell, Eric D. Stein, J. Angus Webb, Theodore
Grantham, Rob A. Lusardi, Julie Zimmerman, Ryan A. Peek, Belize A. Lane,
Jeanette Howard, Samuel Sandoval-Solis. A functional flows approach to
selecting ecologically relevant flow metrics for environmental flow
applications. <em>River Research and Applications</em> 36(2): 318-324.
February 2020. <a href="https://doi.org/10.1002/rra.3575" class="external-link">https://doi.org/10.1002/rra.3575</a><a href="#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>Belize Lane, Noelle Patterson, Leo Qiu, Samuel Sandoval,
Sarah Yarnell, Robert Lusardi, Julie Zimmerman, Eric Stein, Larry Brown,
Theodore Grantham, Jeanette Howard. Functional Flows Calculator v2.32,
University of California, Davis. Davis CA. Feb, 2024, <a href="https://eflows.ucdavis.edu" class="external-link uri">https://eflows.ucdavis.edu</a><a href="#fnref6" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Erin Cain.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
