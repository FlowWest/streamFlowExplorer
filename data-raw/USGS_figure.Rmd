```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, fig.width=15, fig.height=10)
library(tidyverse)
library(lubridate)
library(googleCloudStorageR)
library(ggplot2)
library(scales)
library(janitor)
library(dataRetrieval)
library(leaflet)
library(readr)
library(ggmap)
library(dataRetrieval)
library(stringr)
library(sf)

```



```{r}
usgs_list <- read_csv(here::here("data-raw", "USGS_station_lookup.csv")) |>
  janitor::clean_names() |>
  mutate(gage = str_sub(gage,1,8))

get_lat_lon <- function(station_code){
  site_info <- dataRetrieval::readNWISsite(siteNumbers = station_code)
  coordinates <- ifelse(is.null(site_info), list(NA_integer_, NA_integer_), list(site_info$dec_long_va, site_info$dec_lat_va))
  return(coordinates)
}

usgs_result <- dataRetrieval::readNWISsite(siteNumbers = usgs_list$gage)

usgs_list |> 
  left_join(usgs_result, by = join_by(gage == site_no)) |>
  st_as_sf(coords = c("dec_long_va", "dec_lat_va")) |>
  leaflet::leaflet() |> leaflet::addTiles() |> leaflet::addMarkers()


```